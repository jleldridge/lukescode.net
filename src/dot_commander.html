<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Lukescode.net</title>
        <script 
        src ="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
        </script>
    </head>
    <body style="overflow: hidden; padding:0px; border:0px; margin:0px;">
        <canvas id="main" width="800" height="600" 
        style="background-color:black; padding:0px; border:0px; margin:0px;">   
        </canvas>
        <script type="text/javascript">
            $(function(){
            });

            var canvas = document.getElementById('main');
            //give the canvas keyboard focus
            canvas.setAttribute('tabindex', '0');
            canvas.focus();
            canvas.addEventListener("mousedown", on_mouse_down, false);
            canvas.addEventListener("mouseup", on_mouse_up, false);
            canvas.addEventListener("mousemove", on_mouse_move, false);
            canvas.addEventListener("keypress", on_key_up, false);
            canvas.width = $(window).width();
            canvas.height = $(window).height();
            
            var graphics = canvas.getContext('2d');
            var select_rect = new Object();
            var dots = new Array();

            var DOT_MAX_DX = 10;
            var DOT_MAX_DY = 10;

            for(var i = 0; i < 10; i++){
                var dot = new Object();
                dot.x = (i+5)*20;
                dot.y = (i+5)*40;
                dot.dx = DOT_MAX_DX;
                dot.dy = DOT_MAX_DY;
                dot.radius = 5;
                dot.selected = false;
                dots.push(dot);
            }

            function on_mouse_down(event){
                var x = event.clientX + document.body.scrollLeft +
                    document.documentElement.scrollLeft;
                var y = event.clientY + document.body.scrollTop +
                    document.documentElement.scrollTop;
                x -= canvas.offsetLeft;
                y -= canvas.offsetTop;
                window.mouse_down = true;
                window.mouse_down_x = x;
                window.mouse_down_y = y;
            }

            function on_mouse_up(event){
                window.mouse_down = false;
            }

            function on_mouse_move(event){
                var x = event.clientX + document.body.scrollLeft +
                    document.documentElement.scrollLeft;
                var y = event.clientY + document.body.scrollTop +
                    document.documentElement.scrollTop;
                x -= canvas.offsetLeft;
                y -= canvas.offsetTop;

                window.curr_mouse_x = x;
                window.curr_mouse_y = y;
            }

            function on_key_up(event){
                for (var i = 0; i < window.dots.length; i++){
                    var dot = window.dots[i];
                    if(dot.selected){                
                        //left arrow
                        if (event.keyCode == '37'){
                            dot.dx -= 1;
                            if (dot.dx < 0-DOT_MAX_DX) dot.dx = 0-DOT_MAX_DX;
                        }
                        //right arrow
                        else if(event.keyCode == '39'){
                            dot.dx += 1;
                            if (dot.dx > DOT_MAX_DX) dot.dx = DOT_MAX_DX;
                        }
                        //up arrow
                        if (event.keyCode == '38'){
                            dot.dy -= 1;
                            if (dot.dy < 0-DOT_MAX_DY) dot.dy = 0-DOT_MAX_DY;
                        }
                        //down arrow
                        else if (event.keyCode == '40'){
                            dot.dy += 1;
                            if (dot.dy > DOT_MAX_DY) dot.dy = DOT_MAX_DY;
                        }
                    }
                }
            }

            function main_loop(){
                update();
                render();
            }

            function update(){
                //draw square from mouse_down position to current mouse position
                create_select_rect();
                

                for (var i = 0; i < window.dots.length; i++){
                    var dot = window.dots[i];
                    dot.x += dot.dx;
                    dot.y += dot.dy;

                    check_dot_out_of_bounds(dot);
                }

            }

            function render(){
                graphics.fillStyle = "#000000";
                graphics.fillRect(0, 0, canvas.width, canvas.height);

                graphics.strokeStyle = "#FFFFFF";
                graphics.strokeRect(window.select_rect.x, window.select_rect.y,
                    window.select_rect.width, window.select_rect.height);

                for(var i = 0; i < dots.length; i++){
                    var dot = window.dots[i];
                    if (dot.selected){
                        graphics.fillStyle = "#00FF00";
                    }
                    else{
                        graphics.fillStyle = "#FF0000";
                    }
                    graphics.beginPath();
                    graphics.arc(dot.x, dot.y, dot.radius, 0, 2*Math.PI);
                    graphics.fill();
                }
            }

            function check_dot_collision(dot, rect){
                //check if they don't overlap on x axis
                if ((dot.x < rect.x) || 
                    (dot.x > rect.x+rect.width)){
                    return false;
                }
                //check if they don't overlap on the y axis
                else if((dot.y < rect.y) || 
                    (dot.y > rect.y+rect.height)){
                    return false;
                }
                //if both checks fail, they overlap on both axes, and
                //are colliding
                else{
                    return true;
                }
            }

            function check_dot_out_of_bounds(dot){
                //check for codotions with outside of screen
                if (dot.x > canvas.width){
                    dot.x = canvas.width;
                    dot.dx *= -1;
                }
                else if(dot.x < 0){
                    dot.x = 0;
                    dot.dx *= -1;
                }
                if(dot.y > canvas.height){
                    dot.y = canvas.height;
                    dot.dy *= -1;
                }
                else if(dot.y < 0){
                    dot.y = 0;
                    dot.dy *= -1;
                }
            }

            function create_select_rect(){
                if (window.mouse_down){
                    window.select_rect.x = window.mouse_down_x;
                    window.select_rect.y = window.mouse_down_y;
                    window.select_rect.width = 
                        window.curr_mouse_x-window.select_rect.x;
                    window.select_rect.height = 
                        window.curr_mouse_y-window.select_rect.y;

                    if (window.select_rect.width < 0){
                        window.select_rect.x = curr_mouse_x;
                        window.select_rect.width *= -1;
                    }
                    if (window.select_rect.height < 0){
                        window.select_rect.y = curr_mouse_y;
                        window.select_rect.height *= -1;
                    }
                    
                    for(var i = 0; i < window.dots.length; i++){
                        var dot = dots[i];
                        dot.selected = check_dot_collision(dot, select_rect);
                    }
                }
                else{
                    window.select_rect.width = 0;
                    window.select_rect.height = 0;
                }
            }

            setInterval(main_loop, 1000/25);
        </script>
    </body>
</html>