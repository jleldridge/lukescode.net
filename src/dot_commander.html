<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Lukescode.net</title>
        <script 
        src ="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
        </script>
    </head>
    <body style="overflow: hidden; padding:0px; border:0px; margin:0px;">
        <canvas id="main" width="800" height="600" 
        style="background-color:black; padding:0px; border:0px; margin:0px;">   
        </canvas>
        <script type="text/javascript">
            $(function(){
            });

            var canvas = document.getElementById('main');
            canvas.addEventListener("mousedown", on_mouse_down, false);
            canvas.addEventListener("mouseup", on_mouse_up, false);
            canvas.addEventListener("mousemove", on_mouse_move, false);
            canvas.width = $(window).width();
            canvas.height = $(window).height();
            
            var graphics = canvas.getContext('2d');
            var select_rect = new Object();
            var dots = new Array();

            var DOT_MAX_DX = 10;
            var DOT_MAX_DY = 10;

            for(var i = 0; i < 10; i++){
                var dot = new Object();
                dot.x = (i+5)*20;
                dot.y = (i+5)*40;
                dot.dx = DOT_MAX_DX;
                dot.dy = DOT_MAX_DY;
                dot.radius = 5;
                dot.selected = false;
                dots.push(dot);
            }

            function on_mouse_down(event){
                var x = event.clientX + document.body.scrollLeft +
                    document.documentElement.scrollLeft;
                var y = event.clientY + document.body.scrollTop +
                    document.documentElement.scrollTop;
                x -= canvas.offsetLeft;
                y -= canvas.offsetTop;
                window.mouse_down = true;
                window.mouse_down_x = x;
                window.mouse_down_y = y;
            }

            function on_mouse_up(event){
                window.mouse_down = false;
            }

            function on_mouse_move(event){
                var x = event.clientX + document.body.scrollLeft +
                    document.documentElement.scrollLeft;
                var y = event.clientY + document.body.scrollTop +
                    document.documentElement.scrollTop;
                x -= canvas.offsetLeft;
                y -= canvas.offsetTop;

                window.curr_mouse_x = x;
                window.curr_mouse_y = y;
            }

            function main_loop(){
                update();
                render();
            }

            function update(){
                //draw square from mouse_down position to current mouse position
                
                if (window.mouse_down){
                    window.select_rect.x = window.mouse_down_x;
                    window.select_rect.y = window.mouse_down_y;
                    window.select_rect.width = 
                        window.curr_mouse_x-window.select_rect.x;
                    window.select_rect.height = 
                        window.curr_mouse_y-window.select_rect.y;

                    if (window.select_rect.width < 0){
                        window.select_rect.x = curr_mouse_x;
                        window.select_rect.width *= -1;
                    }
                    if (window.select_rect.height < 0){
                        window.select_rect.y = curr_mouse_y;
                        window.select_rect.height *= -1;
                    }

                    //find dots that are inside the select_rect
                    if (select_rect.width < 3 && select_rect.height < 3){
                        for (var i = 0; i < window.dots.length; i++){
                            var dot = window.dots[i];
                            if(dot.selected){
                                var dot = window.dots[i];
                                dot.dx *= -1;
                                dot.dy *= -1;
                            }
                        }
                    }
                    else{
                        for(var i = 0; i < window.dots.length; i++){
                            var dot = dots[i];
                            //check if they don't overlap on x axis
                            if ((dot.x < select_rect.x) || 
                                (dot.x > select_rect.x+select_rect.width)){
                                dot.selected = false;
                            }
                            //check if they don't overlap on the y axis
                            else if((dot.y < select_rect.y) || 
                                (dot.y > select_rect.y+select_rect.height)){
                                dot.selected = false;
                            }
                            //if both checks fail, they overlap on both axes, and
                            //are colliding
                            else{
                                dot.selected = true;
                            }
                        }
                    }
                }
                else{
                    window.select_rect.width = 0;
                    window.select_rect.height = 0;
                }

                for (var i = 0; i < window.dots.length; i++){
                    var dot = window.dots[i];
                    dot.x += dot.dx;
                    dot.y += dot.dy;

                    //check for codotions with outside of screen
                    if (dot.x > canvas.width){
                        dot.x = canvas.width;
                        dot.dx *= -1;
                    }
                    else if(dot.x < 0){
                        dot.x = 0;
                        dot.dx *= -1;
                    }
                    if(dot.y > canvas.height){
                        dot.y = canvas.height;
                        dot.dy *= -1;
                    }
                    else if(dot.y < 0){
                        dot.y = 0;
                        dot.dy *= -1;
                    }
                }

            }

            function render(){
                graphics.fillStyle = "#000000";
                graphics.fillRect(0, 0, canvas.width, canvas.height);

                graphics.strokeStyle = "#FFFFFF";
                graphics.strokeRect(window.select_rect.x, window.select_rect.y,
                    window.select_rect.width, window.select_rect.height);

                for(var i = 0; i < dots.length; i++){
                    var dot = window.dots[i];
                    if (dot.selected){
                        graphics.fillStyle = "#00FF00";
                    }
                    else{
                        graphics.fillStyle = "#FF0000";
                    }
                    graphics.beginPath();
                    graphics.arc(dot.x, dot.y, dot.radius, 0, 2*Math.PI);
                    graphics.fill();
                }
            }

            setInterval(main_loop, 1000/25);
        </script>
    </body>
</html>